
/* blacklist.c */

#include <stdio.h>
#include <string.h>

#include "drhook.h"

#define FORTRAN_CALL

FORTRAN_CALL void 
blacklist_(int *KATEGORY, int *KPRINT,
	   int *KTEST_MDI, int *KFILL_FBVECTOR,
           int *KCMBLI, double *ZCMCCC,
           int KFEEDBACK[], int *KFEEDBACK_SIZE_PLUS_ONE,
           int NAME_INDEX[], int *NAME_INDEX_LEN,
           double ZDATA[], int *KDATA)
{
  int BL_retcode = 0;
  int nf = *KFEEDBACK_SIZE_PLUS_ONE - 1;
  int ENABLE_printing   = (*KPRINT    > 0) ? 1 : 0;
  int ENABLE_mditesting = (*KTEST_MDI > 0) ? 1 : 0;
  int ENABLE_fill_fbv   = (*KFILL_FBVECTOR > 0) ? 1 : 0;

  /* DRHOOK_START(blacklist_); */ /* Commented out for speed; blackbox.F90 still has it */

  *KCMBLI = 0; /* Reason */
  *ZCMCCC = 0; /* Seriousness */

  {
    extern void (*ptr_C_blacklist_header)(int   *LR          /* last_reason */,
					  double *LS         /* last_seriousness */,
					  int   *LL          /* last_lineno */,
					  int KFEEDBACK[], int KFEEDBACK_SIZE, /* F.B.-vector */
					  int ENABLE_printing,
					  int ENABLE_mditesting,
					  int ENABLE_fill_fbv,
					  const int NAME_INDEX[], int NAME_INDEX_LEN,
					  const double ZDATA[], int KDATA,
					  int *retcode);
    
    extern void (*ptr_C_blacklist_body_entry)(int   *LR      /* last_reason */,
					      double *LS     /* last_seriousness */,
					      int   *LL      /* last_lineno */,
					      int KFEEDBACK[], int KFEEDBACK_SIZE, /* F.B.-vector */
					      int ENABLE_printing,
					      int ENABLE_mditesting,
					      int ENABLE_fill_fbv,
					      const int NAME_INDEX[], int NAME_INDEX_LEN,
					      const double ZDATA[], int KDATA,
					      int *retcode);
    
    /* Call (finally!) the actual blacklisting code, generated by the bl95.x-compiler */

    if (*KATEGORY == 1) { /* Header/report */
      DRHOOK_START(C_blacklist_header);
      ptr_C_blacklist_header(KCMBLI,
			     ZCMCCC,
			     KFEEDBACK,
			     KFEEDBACK+1, nf,
			     ENABLE_printing,
			     ENABLE_mditesting,
			     ENABLE_fill_fbv,
			     NAME_INDEX, *NAME_INDEX_LEN,
			     ZDATA, *KDATA,
			     &BL_retcode);
      DRHOOK_END(0);
    }
    else { /* Body/data */
      DRHOOK_START(C_blacklist_body_entry);
      ptr_C_blacklist_body_entry(KCMBLI,
				 ZCMCCC,
				 KFEEDBACK,
				 KFEEDBACK+1, nf,
				 ENABLE_printing,
				 ENABLE_mditesting,
				 ENABLE_fill_fbv,
				 NAME_INDEX, *NAME_INDEX_LEN,
				 ZDATA, *KDATA,
				 &BL_retcode);
      DRHOOK_END(0);
    }
  }

  /* DRHOOK_END(0); */
}



