


NVFORTRAN (Version     23.1)          02/24/2023  13:52:24      page 1

Switches: -noasm -nodclchk -debug -nodlines -line -list
          -idir .D[1]
          -idir .D[2]
          -idir .D[3]
          -idir .D[4]
          -idir .D[5]
          -idir .D[6]
          -idir .D[7]
          -idir .D[8]
          -idir .D[9]
          -idir .D[10]
          -idir .D[11]
          -idir .D[12]
          -idir .D[13]
          -idir .D[14]
          -idir .D[15]
          -idir .D[16]
          -idir .D[17]
          -idir .D[18]
          -idir .D[19]
          -idir .D[20]
          -idir .D[21]
          -idir .D[22]
          -idir .D[23]
          -idir .D[24]
          -idir .D[25]
          -idir .D[26]
          -idir .D[27]
          -idir .D[28]
          -idir .D[29]
          -idir .D[30]
          -idir .D[31]
          -idir .D[32]
          -idir .D[33]
          -idir .D[34]
          -idir .D[35]
          -idir .D[36]
          -idir .D[37]
          -idir .D[38]
          -idir .D[39]
          -idir .D[40]
          -idir .D[41]
          -idir .D[42]
          -idir .D[43]
          -idir .D[44]
          -idir .D[45]
          -idir .D[46]
          -idir .D[47]
          -idir .D[48]
          -idir .D[49]
          -idir .D[50]
          -idir .D[51]
          -idir .D[52]
          -idir .D[53]
          -idir .D[54]
          -idir .D[55]
          -idir .D[56]
          -idir .D[57]






NVFORTRAN (Version     23.1)          02/24/2023  13:52:24      page 2

          -idir .D[58]
          -idir .D[59]
          -idir .D[60]
          -idir .D[61]
          -idir .D[62]
          -idir .D[63]
          -idir .D[64]
          -idir .D[65]
          -idir .D[66]
          -idir .D[67]
          -idir .D[68]
          -idir .D[69]
          -idir .D[70]
          -idir .D[71]
          -idir .D[72]
          -idir .D[73]
          -idir .D[74]
          -idir .D[75]
          -idir .D[76]
          -idir .D[77]
          -idir .D[78]
          -idir /opt/softs/nvidia/hpc_sdk/Linux_x86_64/23.1/comm_libs/openmpi/openmpi-3.1.5/include
          -idir /opt/softs/nvidia/hpc_sdk/Linux_x86_64/23.1/comm_libs/openmpi/openmpi-3.1.5/lib
          -inform severe -opt 0 -nosave -object -noonetrip
          -depchk on -nostandard     
          -symbol -noupcase    

Filename: modi_trip_change_date.F90

(    1) !#########
(    2) PROGRAM TRIP_CHANGE_DATE
(    3) !############################################
(    4) !
(    5) !!****  *TRIP_CHANGE_DATE*  
(    6) !!
(    7) !!    PURPOSE
(    8) !!    -------
(    9) !
(   10) !     Change the current date in the TRIP restart.
(   11) !     Important for spin up procedure
(   12) !     
(   13) !!      
(   14) !!    AUTHOR
(   15) !!    ------
(   16) !!      B. Decharme
(   17) !!
(   18) !!    MODIFICATIONS
(   19) !!    -------------
(   20) !!      Original    01/14 
(   21) !-------------------------------------------------------------------------------
(   22) !
(   23) !*       0.     DECLARATIONS
(   24) !               ------------
(   25) !
(   26) USE MODD_TRIP_PAR, ONLY : LNCPRINT
(   27) !
(   28) USE NETCDF
(   29) USE MODE_TRIP_NETCDF
(   30) !






NVFORTRAN (Version     23.1)          02/24/2023  13:52:24      page 3

(   31) USE MODI_INIT_TRIP_PAR
(   32) !
(   33) USE YOMHOOK   ,ONLY : LHOOK,   DR_HOOK
(   34) USE PARKIND1  ,ONLY : JPRB
(   35) !
(   36) IMPLICIT NONE
(   37) !
(   38) !*      0.1    declarations of local variables
(   39) !
(   40)  CHARACTER(LEN=NF90_MAX_NAME), PARAMETER :: YFILE    = 'TRIP_RESTART.nc'
(   41)  CHARACTER(LEN=NF90_MAX_NAME), PARAMETER :: YDATE    = 'date'
(   42) INTEGER,                      PARAMETER :: ILISTING = 6
(   43) LOGICAL,                      PARAMETER :: LRW      = .TRUE.
(   44) !
(   45) REAL*4, DIMENSION(4) :: ZDATE_OLD, ZDATE
(   46) REAL,   DIMENSION(4) :: ZREAD
(   47) !
(   48) INTEGER            :: IYEAR
(   49) INTEGER            :: IMONTH
(   50) INTEGER            :: IDAY
(   51) INTEGER            :: ITIME
(   52) !
(   53) INTEGER            :: IC, IDATEID, INCID
(   54) !
(   55) REAL(KIND=JPRB) :: ZHOOK_HANDLE
(   56) !
(   57) !-------------------------------------------------------------------------------
(   58) !
(   59) IF (LHOOK) CALL DR_HOOK('TRIP_CHANGE_DATE',0,ZHOOK_HANDLE)
(   60) !
(   61) !-------------------------------------------------------------------------------
(   62)  CALL INIT_TRIP_PAR
(   63) !-------------------------------------------------------------------------------
(   64) !
(   65) ! * Read current date
(   66) !
(   67) OPEN(UNIT=21, FILE='date_trip', FORM='formatted')
(   68) READ(21, *) IYEAR, IMONTH, IDAY, ITIME
(   69)  CLOSE(21)
(   70) !
(   71) ZDATE(1) = REAL(IYEAR)
(   72) ZDATE(2) = REAL(IMONTH)
(   73) ZDATE(3) = REAL(IDAY)
(   74) ZDATE(4) = REAL(ITIME)
(   75) !
(   76) ! * Open netcdf file
(   77) !
(   78)  CALL NCOPEN(ILISTING,LRW,LNCPRINT,YFILE,INCID)
(   79) !
(   80) ! * read date in restart file
(   81) !
(   82)  CALL NCREAD(ILISTING,INCID,YDATE,ZREAD(:),LNCPRINT)
(   83) ZDATE_OLD(:) = ZREAD(:)
(   84) !
(   85) WRITE(ILISTING,*)'Change date in trip restart :'
(   86) WRITE(ILISTING,*)'Year  :',INT(ZDATE_OLD(1)),'to',IYEAR
(   87) WRITE(ILISTING,*)'Month :',INT(ZDATE_OLD(2)),'to',IMONTH
(   88) WRITE(ILISTING,*)'Day   :',INT(ZDATE_OLD(3)),'to',IDAY






NVFORTRAN (Version     23.1)          02/24/2023  13:52:24      page 4

(   89) WRITE(ILISTING,*)'Time  :',INT(ZDATE_OLD(4)),'to',ITIME
(   90) 
(   91) ! * Write current date in restart file
(   92) !
(   93) IC = NF90_INQ_VARID(INCID,YDATE,IDATEID)
(   94) IF(IC/=NF90_NOERR)THEN
(   95)   WRITE(ILISTING,*)'TRIP_CHANGE_DATE: NF90_INQ_VARID problem'
(   96)   STOP
(   97) ENDIF
(   98) !
(   99) IC = NF90_PUT_VAR(INCID,IDATEID,ZDATE)
(  100) IF(IC/=NF90_NOERR)THEN
(  101)   WRITE(ILISTING,*)'TRIP_CHANGE_DATE: NF90_PUT_VAR problem'
(  102)   STOP
(  103) ENDIF
(  104) !
(  105) WRITE(ILISTING,*)'Sucess in writting current date'
(  106) !
(  107) ! * Close netcdf file
(  108) !
(  109)  CALL NCCLOSE(ILISTING,LNCPRINT,YFILE,INCID)
(  110) !
(  111) IF (LHOOK) CALL DR_HOOK('TRIP_CHANGE_DATE',1,ZHOOK_HANDLE)
(  112) !
(  113) !-------------------------------------------------------------------------------
(  114) END PROGRAM TRIP_CHANGE_DATE






































NVFORTRAN (Version     23.1)          02/24/2023  13:52:24      page 5

(    1) # 1 "modi_trip_change_date.F90"
(    1) !#########
(    2) PROGRAM TRIP_CHANGE_DATE
(    3) !############################################
(    4) !
(    5) !!****  *TRIP_CHANGE_DATE*  
(    6) !!
(    7) !!    PURPOSE
(    8) !!    -------
(    9) !
(   10) !     Change the current date in the TRIP restart.
(   11) !     Important for spin up procedure
(   12) !     
(   13) !!      
(   14) !!    AUTHOR
(   15) !!    ------
(   16) !!      B. Decharme
(   17) !!
(   18) !!    MODIFICATIONS
(   19) !!    -------------
(   20) !!      Original    01/14 
(   21) !-------------------------------------------------------------------------------
(   22) !
(   23) !*       0.     DECLARATIONS
(   24) !               ------------
(   25) !
(   26) USE MODD_TRIP_PAR, ONLY : LNCPRINT
(   27) !
(   28) USE NETCDF
(   29) USE MODE_TRIP_NETCDF
(   30) !
(   31) USE MODI_INIT_TRIP_PAR
(   32) !
(   33) USE YOMHOOK   ,ONLY : LHOOK,   DR_HOOK
(   34) USE PARKIND1  ,ONLY : JPRB
(   35) !
(   36) IMPLICIT NONE
(   37) !
(   38) !*      0.1    declarations of local variables
(   39) !
(   40)  CHARACTER(LEN=NF90_MAX_NAME), PARAMETER :: YFILE    = 'TRIP_RESTART.nc'
(   41)  CHARACTER(LEN=NF90_MAX_NAME), PARAMETER :: YDATE    = 'date'
(   42) INTEGER,                      PARAMETER :: ILISTING = 6
(   43) LOGICAL,                      PARAMETER :: LRW      = .TRUE.
(   44) !
(   45) REAL*4, DIMENSION(4) :: ZDATE_OLD, ZDATE
(   46) REAL,   DIMENSION(4) :: ZREAD
(   47) !
(   48) INTEGER            :: IYEAR
(   49) INTEGER            :: IMONTH
(   50) INTEGER            :: IDAY
(   51) INTEGER            :: ITIME
(   52) !
(   53) INTEGER            :: IC, IDATEID, INCID
(   54) !
(   55) REAL(KIND=JPRB) :: ZHOOK_HANDLE
(   56) !
(   57) !-------------------------------------------------------------------------------






NVFORTRAN (Version     23.1)          02/24/2023  13:52:24      page 6

(   58) !
(   59) IF (LHOOK) CALL DR_HOOK('TRIP_CHANGE_DATE',0,ZHOOK_HANDLE)
(   60) !
(   61) !-------------------------------------------------------------------------------
(   62)  CALL INIT_TRIP_PAR
(   63) !-------------------------------------------------------------------------------
(   64) !
(   65) ! * Read current date
(   66) !
(   67) OPEN(UNIT=21, FILE='date_trip', FORM='formatted')
(   68) READ(21, *) IYEAR, IMONTH, IDAY, ITIME
(   69)  CLOSE(21)
(   70) !
(   71) ZDATE(1) = REAL(IYEAR)
(   72) ZDATE(2) = REAL(IMONTH)
(   73) ZDATE(3) = REAL(IDAY)
(   74) ZDATE(4) = REAL(ITIME)
(   75) !
(   76) ! * Open netcdf file
(   77) !
(   78)  CALL NCOPEN(ILISTING,LRW,LNCPRINT,YFILE,INCID)
(   79) !
(   80) ! * read date in restart file
(   81) !
(   82)  CALL NCREAD(ILISTING,INCID,YDATE,ZREAD(:),LNCPRINT)
(   83) ZDATE_OLD(:) = ZREAD(:)
(   84) !
(   85) WRITE(ILISTING,*)'Change date in trip restart :'
(   86) WRITE(ILISTING,*)'Year  :',INT(ZDATE_OLD(1)),'to',IYEAR
(   87) WRITE(ILISTING,*)'Month :',INT(ZDATE_OLD(2)),'to',IMONTH
(   88) WRITE(ILISTING,*)'Day   :',INT(ZDATE_OLD(3)),'to',IDAY
(   89) WRITE(ILISTING,*)'Time  :',INT(ZDATE_OLD(4)),'to',ITIME
(   90) # 91 "modi_trip_change_date.F90"
(   91) ! * Write current date in restart file
(   92) !
(   93) IC = NF90_INQ_VARID(INCID,YDATE,IDATEID)
(   94) IF(IC/=NF90_NOERR)THEN
(   95)   WRITE(ILISTING,*)'TRIP_CHANGE_DATE: NF90_INQ_VARID problem'
(   96)   STOP
(   97) ENDIF
(   98) !
(   99) IC = NF90_PUT_VAR(INCID,IDATEID,ZDATE)
(  100) IF(IC/=NF90_NOERR)THEN
(  101)   WRITE(ILISTING,*)'TRIP_CHANGE_DATE: NF90_PUT_VAR problem'
(  102)   STOP
(  103) ENDIF
(  104) !
(  105) WRITE(ILISTING,*)'Sucess in writting current date'
(  106) !
(  107) ! * Close netcdf file
(  108) !
(  109)  CALL NCCLOSE(ILISTING,LNCPRINT,YFILE,INCID)
(  110) !
(  111) IF (LHOOK) CALL DR_HOOK('TRIP_CHANGE_DATE',1,ZHOOK_HANDLE)
(  112) !
(  113) !-------------------------------------------------------------------------------
(  114) END PROGRAM TRIP_CHANGE_DATE
