


NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 1

Switches: -noasm -nodclchk -debug -nodlines -line -list
          -idir .D[1]
          -idir .D[2]
          -idir .D[3]
          -idir .D[4]
          -idir .D[5]
          -idir .D[6]
          -idir .D[7]
          -idir .D[8]
          -idir .D[9]
          -idir .D[10]
          -idir .D[11]
          -idir .D[12]
          -idir .D[13]
          -idir .D[14]
          -idir .D[15]
          -idir .D[16]
          -idir .D[17]
          -idir .D[18]
          -idir .D[19]
          -idir .D[20]
          -idir .D[21]
          -idir .D[22]
          -idir .D[23]
          -idir .D[24]
          -idir .D[25]
          -idir .D[26]
          -idir .D[27]
          -idir .D[28]
          -idir .D[29]
          -idir .D[30]
          -idir .D[31]
          -idir .D[32]
          -idir .D[33]
          -idir .D[34]
          -idir .D[35]
          -idir .D[36]
          -idir .D[37]
          -idir .D[38]
          -idir .D[39]
          -idir .D[40]
          -idir .D[41]
          -idir .D[42]
          -idir .D[43]
          -idir .D[44]
          -idir .D[45]
          -idir .D[46]
          -idir .D[47]
          -idir .D[48]
          -idir .D[49]
          -idir .D[50]
          -idir .D[51]
          -idir .D[52]
          -idir .D[53]
          -idir .D[54]
          -idir .D[55]
          -idir .D[56]
          -idir .D[57]






NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 2

          -idir .D[58]
          -idir .D[59]
          -idir .D[60]
          -idir .D[61]
          -idir .D[62]
          -idir .D[63]
          -idir .D[64]
          -idir .D[65]
          -idir .D[66]
          -idir .D[67]
          -idir .D[68]
          -idir .D[69]
          -idir .D[70]
          -idir .D[71]
          -idir .D[72]
          -idir .D[73]
          -idir .D[74]
          -idir .D[75]
          -idir .D[76]
          -idir .D[77]
          -idir .D[78]
          -idir /opt/softs/nvidia/hpc_sdk/Linux_x86_64/23.1/comm_libs/openmpi/openmpi-3.1.5/include
          -idir /opt/softs/nvidia/hpc_sdk/Linux_x86_64/23.1/comm_libs/openmpi/openmpi-3.1.5/lib
          -inform severe -opt 0 -nosave -object -noonetrip
          -depchk on -nostandard     
          -symbol -noupcase    

Filename: fy3_corrections.F90

(    1) Subroutine FY3_Corrections(       &
(    2) &           Instr_Number,         & ! IN: FY3A=1, FY3B=2
(    3) &           IChannel_Number,      & ! IN 
(    4) &           ICorrection_Version,  & ! IN:0 = no corrections
(    5) &           ZTB,                  & ! IN: observed TB.
(    6) &           ZDelta_TB)              ! OUT: correction to Tb
(    7) 
(    8) ! ======================================================================
(    9) !  Subroutine  FY3_Corrections
(   10) !  ---------------------------------
(   11) !
(   12) !  Purpose
(   13) !  -------
(   14) !  This routine calculates the non-linearity correction for 
(   15) !  the FY-3A and B sensors, based on coefficients stored in 
(   16) !  this subroutine, the observed brightness temperature,
(   17) !  instrument pararameters (sensor and channel numbers)
(   18) !  as well as a correction 'version number' 
(   19) !  which is stored (by the calling routine) in the ODB
(   20) !  This routine is only called for FY3 MWTS sensors.
(   21) !
(   22) !  The correction takes the form:
(   23) !
(   24) !  ZDelta_TB = a0 + a1*TB + a2*TB^2
(   25) !
(   26) !  In the calling routine, the new brightness temperature is:
(   27) !
(   28) !  TB_new = TB_old - ZDelta_TB
(   29) !  
(   30) !  Interface






NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 3

(   31) !  ---------
(   32) !  Instr_Number         !IN : FY3A=1, FY3B=2
(   33) !  IChannel_Number      !IN : Integer in the range [1,4] for MWTS
(   34) !  ICorrection_Version  !IN : Currently 0 (no corrections) or 1,
(   35) !                             can be extended if new values required
(   36) !  ZTB                  !IN : Observed Brightness temperature.
(   37) !  ZDelta_TB            !OUT: correction to brightness temperature 
(   38) !                             note: TB_new = TB_old - ZDelta_TB
(   39) !                             in calling routine
(   40) !   
(   41) !  Structure
(   42) !  ---------
(   43) !  0. Initialise output (ZDelta_TB) to zero.
(   44) !  1. Initialise the coefficient array.
(   45) !  2. [If input sensible, then] Compute the correction.
(   46) !  
(   47) !  Date              Author                  Comments
(   48) !  ====              ======                  ========
(   49) !  19/10/2010        W. Bell                 First version
(   50) !  24/11/2011        Q. Lu                   Update for FY3B
(   51) !  15/01/2013        S. English              Further update for FY3B
(   52) !
(   53) !=======================================================================
(   54) 
(   55) ! === USE statements ========
(   56) 
(   57) 
(   58) USE PARKIND1  ,ONLY : JPIM     ,JPRD
(   59) USE YOMHOOK   ,ONLY : LHOOK,   DR_HOOK
(   60) 
(   61) ! === End USE statements ====
(   62) 
(   63) Implicit None
(   64) 
(   65) !=========== declarations ================================================= 
(   66) 
(   67) ! argument list: inputs
(   68) 
(   69) INTEGER(KIND=JPIM),INTENT(IN)    :: Instr_Number
(   70) INTEGER(KIND=JPIM),INTENT(IN)    :: IChannel_Number
(   71) INTEGER(KIND=JPIM),INTENT(IN)    :: ICorrection_Version
(   72) 
(   73) REAL(KIND=JPRD)   ,INTENT(IN)   ::  ZTB
(   74) 
(   75) ! argument list:  outputs
(   76) 
(   77) REAL(KIND=JPRD)   ,INTENT(OUT)   ::  ZDelta_TB
(   78) 
(   79) 
(   80) ! local variables
(   81) 
(   82) INTEGER(KIND=JPIM),parameter     :: NVIND = 2147483647
(   83) INTEGER(KIND=JPIM),parameter     :: num_fy3s=2
(   84) INTEGER(KIND=JPIM),parameter     :: num_fy3_channels=4
(   85) INTEGER(KIND=JPIM),parameter     :: num_versions=1
(   86) 
(   87) REAL(KIND=JPRD) :: ZHOOK_HANDLE
(   88) REAL(KIND=JPRD), Dimension(1:num_fy3s,0:num_versions,3,num_fy3_channels) &






NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 4

(   89) &                                :: non_lin_coeffs
(   90) 
(   91) 
(   92) 
(   93) !======== end declarations ===============================================
(   94) 
(   95) IF (LHOOK) CALL DR_HOOK('FY3_CORRECTION',0,ZHOOK_HANDLE)
(   96) 
(   97) ! ==============================================
(   98) ! Section 0: Initialise output argument to zero
(   99) !===============================================
(  100) 
(  101) ZDelta_TB=0.0
(  102) 
(  103) ! ==============================================
(  104) ! Section 1: Initialise Coefficient array.
(  105) ! If new versions are added, both FY3A and FY3B
(  106) ! coefficients need to be copied and updated
(  107) ! as there is only one 'Version number' for the 
(  108) ! corrections.
(  109) ! Version 0: no corrections for FY-3A or FY-3B
(  110) ! Version 1: optimal corrs for 3A, none for 3B
(  111) ! Version #: update as appropriate ...
(  112) ! DO NOT OVERWRITE EARLIER VERSIONS !
(  113) !===============================================
(  114) 
(  115) 
(  116) !                      a0                  a1                   a2
(  117) 
(  118) ! FY-3A, Version 0 corrections
(  119) 
(  120) non_lin_coeffs(1,0,1:3,1:4) =        &
(  121) & reshape( source=(/ 0.00000,             0.00000,            0.00000, &
(  122) &                    0.00000,             0.00000,            0.00000, &
(  123) &                    0.00000,             0.00000,            0.00000, &
(  124) &                    0.00000,             0.00000,            0.00000 /), &
(  125) &                    shape=(/3, 4/)                                     )
(  126)                                              
(  127) 
(  128) 
(  129) ! FY-3A, Version 1 corrections
(  130) 
(  131) non_lin_coeffs(1,1,1:3,1:4) =           &
(  132) & reshape( source=(/ 0.00000,             0.00000,            0.00000,            &
(  133) &                    0.079546796,         0.015843045,       -0.000060438557,  & 
(  134) &                    0.070824104,         0.025371222,       -0.000107616679,  &
(  135) &                    0.000859831,         0.027636840,       -0.000103839638 /), &
(  136) &                    shape=(/3, 4/)                                     )
(  137)                                              
(  138)                                              
(  139) ! FY-3B, Version 0 corrections
(  140) 
(  141) non_lin_coeffs(2,0,1:3,1:4) =     & 
(  142) &   reshape( source=(/ 0.00000,             0.00000,            0.00000, &
(  143) &                      0.00000,             0.00000,            0.00000, &
(  144) &                      0.00000,             0.00000,            0.00000, &
(  145) &                      0.00000,             0.00000,            0.00000 /), &
(  146) &                      shape=(/3, 4/)                                     ) 






NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 5

(  147)                                              
(  148)                                              
(  149) ! FY-3B, Version 1 corrections
(  150) 
(  151) non_lin_coeffs(2,1,1:3,1:4) =        &
(  152) & reshape( source=(/ 0.00000,             0.00000,            0.00000, &
(  153) &                    -0.003809237,        0.001423785,       -0.000004799, &
(  154) &                    0.1338578223,       -0.003429888,       -0.000002933, &
(  155) &                   -0.0272090345,        0.010169968,       -0.000034277  /), &
(  156) &                      shape=(/3, 4/)                                     )
(  157) 
(  158)                                                       
(  159) 
(  160) ! ==============================================
(  161) ! Section 2: IF input parameters sensible  THEN
(  162) !  compute non-linearity correction
(  163) !  ELSE Do nothing and leave correction
(  164) !  set at zero.
(  165) !==============================================
(  166) 
(  167) If (        (Instr_Number .gt. 0)         .AND.   (Instr_Number .lt. 3)     .AND.     &
(  168)       &     (IChannel_Number .gt. 0)      .AND.   (IChannel_Number .lt. 5)  .AND.  &
(  169)       &     (ICorrection_Version .gt. -1) .AND.   (ICorrection_Version .lt. 2) .AND. &
(  170)       &     ZTB /= -NVIND ) Then
(  171) 
(  172) 
(  173)       ZDelta_TB =     &
(  174)       & non_lin_coeffs(Instr_Number,ICorrection_Version,1,IChannel_Number)     +  &
(  175)       & non_lin_coeffs(Instr_Number,ICorrection_Version,2,IChannel_Number)*ZTB +  &
(  176)       & non_lin_coeffs(Instr_Number,ICorrection_Version,3,IChannel_Number)*ZTB**2
(  177) 
(  178) End If
(  179) 
(  180) IF (LHOOK) CALL DR_HOOK('FY3_CORRECTION',1,ZHOOK_HANDLE)
(  181) 
(  182) End
(  183) 
(  184) 
(  185) 
(  186) 
(  187) 
(  188) 
(  189) 
(  190) 




















NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 6

(    1) # 1 "fy3_corrections.F90"
(    1) Subroutine FY3_Corrections(       &
(    2) &           Instr_Number,         & ! IN: FY3A=1, FY3B=2
(    3) &           IChannel_Number,      & ! IN 
(    4) &           ICorrection_Version,  & ! IN:0 = no corrections
(    5) &           ZTB,                  & ! IN: observed TB.
(    6) &           ZDelta_TB)              ! OUT: correction to Tb
(    7) # 8 "fy3_corrections.F90"
(    8) ! ======================================================================
(    9) !  Subroutine  FY3_Corrections
(   10) !  ---------------------------------
(   11) !
(   12) !  Purpose
(   13) !  -------
(   14) !  This routine calculates the non-linearity correction for 
(   15) !  the FY-3A and B sensors, based on coefficients stored in 
(   16) !  this subroutine, the observed brightness temperature,
(   17) !  instrument pararameters (sensor and channel numbers)
(   18) !  as well as a correction 'version number' 
(   19) !  which is stored (by the calling routine) in the ODB
(   20) !  This routine is only called for FY3 MWTS sensors.
(   21) !
(   22) !  The correction takes the form:
(   23) !
(   24) !  ZDelta_TB = a0 + a1*TB + a2*TB^2
(   25) !
(   26) !  In the calling routine, the new brightness temperature is:
(   27) !
(   28) !  TB_new = TB_old - ZDelta_TB
(   29) !  
(   30) !  Interface
(   31) !  ---------
(   32) !  Instr_Number         !IN : FY3A=1, FY3B=2
(   33) !  IChannel_Number      !IN : Integer in the range [1,4] for MWTS
(   34) !  ICorrection_Version  !IN : Currently 0 (no corrections) or 1,
(   35) !                             can be extended if new values required
(   36) !  ZTB                  !IN : Observed Brightness temperature.
(   37) !  ZDelta_TB            !OUT: correction to brightness temperature 
(   38) !                             note: TB_new = TB_old - ZDelta_TB
(   39) !                             in calling routine
(   40) !   
(   41) !  Structure
(   42) !  ---------
(   43) !  0. Initialise output (ZDelta_TB) to zero.
(   44) !  1. Initialise the coefficient array.
(   45) !  2. [If input sensible, then] Compute the correction.
(   46) !  
(   47) !  Date              Author                  Comments
(   48) !  ====              ======                  ========
(   49) !  19/10/2010        W. Bell                 First version
(   50) !  24/11/2011        Q. Lu                   Update for FY3B
(   51) !  15/01/2013        S. English              Further update for FY3B
(   52) !
(   53) !=======================================================================
(   54) # 55 "fy3_corrections.F90"
(   55) ! === USE statements ========
(   56) # 58 "fy3_corrections.F90"
(   58) USE PARKIND1  ,ONLY : JPIM     ,JPRD






NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 7

(   59) USE YOMHOOK   ,ONLY : LHOOK,   DR_HOOK
(   60) # 61 "fy3_corrections.F90"
(   61) ! === End USE statements ====
(   62) # 63 "fy3_corrections.F90"
(   63) Implicit None
(   64) # 65 "fy3_corrections.F90"
(   65) !=========== declarations ================================================= 
(   66) # 67 "fy3_corrections.F90"
(   67) ! argument list: inputs
(   68) # 69 "fy3_corrections.F90"
(   69) INTEGER(KIND=JPIM),INTENT(IN)    :: Instr_Number
(   70) INTEGER(KIND=JPIM),INTENT(IN)    :: IChannel_Number
(   71) INTEGER(KIND=JPIM),INTENT(IN)    :: ICorrection_Version
(   72) # 73 "fy3_corrections.F90"
(   73) REAL(KIND=JPRD)   ,INTENT(IN)   ::  ZTB
(   74) # 75 "fy3_corrections.F90"
(   75) ! argument list:  outputs
(   76) # 77 "fy3_corrections.F90"
(   77) REAL(KIND=JPRD)   ,INTENT(OUT)   ::  ZDelta_TB
(   78) # 80 "fy3_corrections.F90"
(   80) ! local variables
(   81) # 82 "fy3_corrections.F90"
(   82) INTEGER(KIND=JPIM),parameter     :: NVIND = 2147483647
(   83) INTEGER(KIND=JPIM),parameter     :: num_fy3s=2
(   84) INTEGER(KIND=JPIM),parameter     :: num_fy3_channels=4
(   85) INTEGER(KIND=JPIM),parameter     :: num_versions=1
(   86) # 87 "fy3_corrections.F90"
(   87) REAL(KIND=JPRD) :: ZHOOK_HANDLE
(   88) REAL(KIND=JPRD), Dimension(1:num_fy3s,0:num_versions,3,num_fy3_channels) &
(   89) &                                :: non_lin_coeffs
(   90) # 93 "fy3_corrections.F90"
(   93) !======== end declarations ===============================================
(   94) # 95 "fy3_corrections.F90"
(   95) IF (LHOOK) CALL DR_HOOK('FY3_CORRECTION',0,ZHOOK_HANDLE)
(   96) # 97 "fy3_corrections.F90"
(   97) ! ==============================================
(   98) ! Section 0: Initialise output argument to zero
(   99) !===============================================
(  100) # 101 "fy3_corrections.F90"
(  101) ZDelta_TB=0.0
(  102) # 103 "fy3_corrections.F90"
(  103) ! ==============================================
(  104) ! Section 1: Initialise Coefficient array.
(  105) ! If new versions are added, both FY3A and FY3B
(  106) ! coefficients need to be copied and updated
(  107) ! as there is only one 'Version number' for the 
(  108) ! corrections.
(  109) ! Version 0: no corrections for FY-3A or FY-3B
(  110) ! Version 1: optimal corrs for 3A, none for 3B
(  111) ! Version #: update as appropriate ...
(  112) ! DO NOT OVERWRITE EARLIER VERSIONS !
(  113) !===============================================
(  114) # 116 "fy3_corrections.F90"
(  116) !                      a0                  a1                   a2
(  117) # 118 "fy3_corrections.F90"
(  118) ! FY-3A, Version 0 corrections
(  119) # 120 "fy3_corrections.F90"
(  120) non_lin_coeffs(1,0,1:3,1:4) =        &






NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 8

(  121) & reshape( source=(/ 0.00000,             0.00000,            0.00000, &
(  122) &                    0.00000,             0.00000,            0.00000, &
(  123) &                    0.00000,             0.00000,            0.00000, &
(  124) &                    0.00000,             0.00000,            0.00000 /), &
(  125) &                    shape=(/3, 4/)                                     )
(  126)                                              
(  127) # 129 "fy3_corrections.F90"
(  129) ! FY-3A, Version 1 corrections
(  130) # 131 "fy3_corrections.F90"
(  131) non_lin_coeffs(1,1,1:3,1:4) =           &
(  132) & reshape( source=(/ 0.00000,             0.00000,            0.00000,            &
(  133) &                    0.079546796,         0.015843045,       -0.000060438557,  & 
(  134) &                    0.070824104,         0.025371222,       -0.000107616679,  &
(  135) &                    0.000859831,         0.027636840,       -0.000103839638 /), &
(  136) &                    shape=(/3, 4/)                                     )
(  137)                                              
(  138)                                              
(  139) ! FY-3B, Version 0 corrections
(  140) # 141 "fy3_corrections.F90"
(  141) non_lin_coeffs(2,0,1:3,1:4) =     & 
(  142) &   reshape( source=(/ 0.00000,             0.00000,            0.00000, &
(  143) &                      0.00000,             0.00000,            0.00000, &
(  144) &                      0.00000,             0.00000,            0.00000, &
(  145) &                      0.00000,             0.00000,            0.00000 /), &
(  146) &                      shape=(/3, 4/)                                     ) 
(  147)                                              
(  148)                                              
(  149) ! FY-3B, Version 1 corrections
(  150) # 151 "fy3_corrections.F90"
(  151) non_lin_coeffs(2,1,1:3,1:4) =        &
(  152) & reshape( source=(/ 0.00000,             0.00000,            0.00000, &
(  153) &                    -0.003809237,        0.001423785,       -0.000004799, &
(  154) &                    0.1338578223,       -0.003429888,       -0.000002933, &
(  155) &                   -0.0272090345,        0.010169968,       -0.000034277  /), &
(  156) &                      shape=(/3, 4/)                                     )
(  157) # 158 "fy3_corrections.F90"
(  158)                                                       
(  159) # 160 "fy3_corrections.F90"
(  160) ! ==============================================
(  161) ! Section 2: IF input parameters sensible  THEN
(  162) !  compute non-linearity correction
(  163) !  ELSE Do nothing and leave correction
(  164) !  set at zero.
(  165) !==============================================
(  166) # 167 "fy3_corrections.F90"
(  167) If (        (Instr_Number .gt. 0)         .AND.   (Instr_Number .lt. 3)     .AND.     &
(  168)       &     (IChannel_Number .gt. 0)      .AND.   (IChannel_Number .lt. 5)  .AND.  &
(  169)       &     (ICorrection_Version .gt. -1) .AND.   (ICorrection_Version .lt. 2) .AND. &
(  170)       &     ZTB /= -NVIND ) Then
(  171) # 173 "fy3_corrections.F90"
(  173)       ZDelta_TB =     &
(  174)       & non_lin_coeffs(Instr_Number,ICorrection_Version,1,IChannel_Number)     +  &
(  175)       & non_lin_coeffs(Instr_Number,ICorrection_Version,2,IChannel_Number)*ZTB +  &
(  176)       & non_lin_coeffs(Instr_Number,ICorrection_Version,3,IChannel_Number)*ZTB**2
(  177) # 178 "fy3_corrections.F90"
(  178) End If
(  179) # 180 "fy3_corrections.F90"
(  180) IF (LHOOK) CALL DR_HOOK('FY3_CORRECTION',1,ZHOOK_HANDLE)






NVFORTRAN (Version     23.1)          02/24/2023  13:40:02      page 9

(  181) # 182 "fy3_corrections.F90"
(  182) End
